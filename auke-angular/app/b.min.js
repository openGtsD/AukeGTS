"use strict";var domain="http://89.221.242.66:8888";var service="http://89.221.242.66:8080";angular.module("aukeGTS",["ngResource","ui.router","ui.bootstrap","uiGmapgoogle-maps"]).factory("aukeUtil",function(){return{baseURL:domain,serviceURL:service}}).config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self",domain+"/app/scripts/components/directives/**",domain+"/app/scripts/ui/tracker/*.html"])});"use strict";angular.module("aukeGTS").config(function($stateProvider,$urlRouterProvider,TrackerCtrl){var domain="http://89.221.242.66:8888";$urlRouterProvider.otherwise("/register");$stateProvider.state("update",{url:"/update",templateUrl:domain+"/app/scripts/ui/tracker/update.html",controller:TrackerCtrl.name,resolve:TrackerCtrl.resolve}).state("register",{url:"/register",templateUrl:domain+"/app/scripts/ui/tracker/register.html",controller:TrackerCtrl.name,resolve:TrackerCtrl.resolve}).state("delete",{url:"/delete",templateUrl:domain+"/app/scripts/ui/tracker/delete.html",controller:TrackerCtrl.name,resolve:TrackerCtrl.resolve})});"use strict";angular.module("aukeGTS").directive("aukeBtn",function(aukeUtil){return{templateUrl:function(tElemenet,tAttrs){var pathToTemplate=aukeUtil.baseURL+"/app/scripts/components/directives/aukeBtn.tpl.html";return tAttrs.templateUrl||pathToTemplate},link:function(scope,element,attrs){scope.hiddenHome=attrs.hiddenHome}}});"use strict";angular.module("aukeGTS").directive("registrationForm",function(aukeUtil){return{templateUrl:function(tElemenet,tAttrs){return tAttrs.templateUrl||aukeUtil.baseURL+"/app/scripts/components/directives/registrationForm.tpl.html"},link:function(scope,element,attrs){scope.mode=attrs.mode}}});angular.module("aukeGTS").factory("trackerService",function($http,aukeUtil){var serviceURL=aukeUtil.serviceURL;var trackerAPI={};trackerAPI.loadDroneWithinView=function(json,layerId,zoom){var url=serviceURL+"/drone/load-drone-in-view/"+layerId+"/"+zoom;return $http.post(url,json)};trackerAPI.getTracker=function(marker,map){return trackerAPI.load(marker.key)};trackerAPI.create=function(id){var url=serviceURL+"/drone/register/"+id;return $http.post(url)};trackerAPI.delete=function(id){var url=serviceURL+"/drone/remove/"+id;return $http.post(url)};trackerAPI.load=function(id){var url=serviceURL+"/drone/get-tracker/"+id;return $http.post(url)};trackerAPI.update=function(tracker){var url=serviceURL+"/drone/update/";return $http.post(url,tracker)};return trackerAPI});"use strict";angular.module("aukeGTS").constant("HomeCtrl",{name:"HomeCtrl",resolve:{}});angular.module("aukeGTS").controller("HomeCtrl",["$scope","$stateParams","trackerService","uiGmapGoogleMapApi","$timeout","$interval","uiGmapIsReady","aukeUtil",function($scope,$stateParams,trackerService,uiGmapGoogleMapApi,$timeout,$interval,uiGmapIsReady,aukeUtil){$scope.sizes=[{name:"REAL",value:"REAL"},{name:"SIMULATED",value:"SIMULATED"}];var layerParam=$stateParams.layer;if(layerParam==null||layerParam==""){$scope.item=$scope.sizes[0]}else{$scope.item=layerParam!==""&&$scope.sizes[0].value==layerParam?$scope.sizes[0]:$scope.sizes[1]}$scope.layer=$scope.item.value;$scope.update=function(){$scope.layer=$scope.item.value;$scope.reMakeInfoBubble();$scope.loadDroneWithinView($scope.myMap)};uiGmapGoogleMapApi.then(function(maps){$scope.markers=[];$scope.myMap="";$scope.map={center:{latitude:0,longitude:0},zoom:3,minZoom:3,options:{},control:{},events:{tilesloaded:function(maps,eventName,args){},dragend:function(maps,eventName,args){},zoom_changed:function(maps,eventName,args){var zoom=maps.getZoom();$scope.myInterval=$interval(function(){zoom=maps.getZoom();if(zoom>=11){$scope.loadDroneWithinView(maps)}else{clearInterval($scope.myInterval);$scope.myInterval=null}},1e4)},idle:function(maps,eventName,args){$scope.myMap=maps;$scope.loadDroneWithinView(maps)}}}});$scope.loadDroneWithinView=function(map){var mapBound=map.getBounds();var zoom=map.getZoom();if($stateParams.id!=null&&$stateParams.id!=""){var markers=[];trackerService.load($stateParams.id).success(function(response){if(response.data&&response.data.length>0){var marker=$scope.createMarker(response.data[0]);markers.push(marker);$scope.markers=markers;var posn=new google.maps.LatLng(response.data[0].currentPosition.latitude,response.data[0].currentPosition.longitude);var bounds=new google.maps.LatLngBounds;bounds.extend(posn);map.fitBounds(bounds)}});$stateParams.id="";$("#zoomId").text(zoom);$("#type").text(zoom>=11?"drone":"position");$("#trackerNumber").text($scope.markers.length)}else{var ne=mapBound.getNorthEast();var sw=mapBound.getSouthWest();var dataObject={southWestLat:sw.lat(),southWestLon:sw.lng(),northEastLat:ne.lat(),northEastLon:ne.lng()};trackerService.loadDroneWithinView(dataObject,$scope.layer,zoom).success(function(response){var markers=[];if(response.data.length>0){var data=response.data;for(var i=0;i<data.length;i++){var marker=$scope.createMarker(data[i]);markers.push(marker)}}$scope.markers=markers;$("#zoomId").text(zoom);$("#type").text(zoom>=11?"drone":"position");$("#trackerNumber").text($scope.markers.length)})}};$scope.createMarker=function(tracker){var marker={id:tracker.id,icon:$scope.myMap.getZoom()>=11?aukeUtil.baseURL+"/app/images/flight.gif":"",latitude:tracker.currentPosition.latitude,longitude:tracker.currentPosition.longitude,showWindow:false,numbertracker:tracker.numtrackers,title:tracker.name,options:{labelContent:tracker.name},events:{dblclick:function(){var posn=new google.maps.LatLng(tracker.currentPosition.latitude,tracker.currentPosition.longitude);var bounds=new google.maps.LatLngBounds;bounds.extend(posn);$scope.myMap.fitBounds(bounds)},click:function(marker){if($scope.myMap.getZoom()<11){var div=document.createElement("DIV");div.innerHTML="<div>Number tracker is: "+tracker.numtrackers+"</div>";$scope.reMakeInfoBubble();$scope.infoBubble.open($scope.myMap,marker);$scope.infoBubble.addTab("Position Information",div)}else{$scope.getTracker(marker,$scope.myMap)}}}};return marker};$scope.getTracker=function(marker,map){trackerService.getTracker(marker,map).success(function(response){if(response.data&&response.data.length>0){var div=document.createElement("DIV");div.innerHTML=$scope.buildContent(response.data[0]);$scope.reMakeInfoBubble();$scope.infoBubble.open(map,marker);$scope.infoBubble.addTab("Tracker Information",div);$scope.infoBubble.addTab("Flyer Information","Comming soon...")}})};$scope.buildContent=function(data){return"<ul>"+"<li>Id: <span class='highlight'>"+data.id+"</span></li><li>GPS: <span class='highlight'>"+data.currentPosition.latitude+" / "+data.currentPosition.longitude+"</span></li><li>Altitude: <span class='highlight'>"+data.currentPosition.altitude+"</span></li><li>Speed: <span class='highlight'>"+data.currentPosition.speed+"</span></li>"+"<li>Moving: <span class='highlight'>"+data.moving+"</span></li> <li>Name: <span class='highlight'>"+data.name+"</span></li><li>Time: <span class='highlight'>"+new Date(data.currentPosition.time*1e3)+"</li></ul>"};$scope.makeNewInfoBuddle=function(){var info=new InfoBubble({shadowStyle:1,padding:10,borderRadius:5,minWidth:200,borderWidth:1,disableAutoPan:true,hideCloseButton:false});return info};$scope.reMakeInfoBubble=function(){if($scope.infoBubble){$scope.infoBubble.close();delete $scope.infoBubble;$scope.infoBubble=$scope.makeNewInfoBuddle()}};$scope.infoBubble=$scope.makeNewInfoBuddle();google.maps.event.addDomListener(window,"resize",function(){})}]);"use strict";angular.module("aukeGTS").constant("TrackerCtrl",{name:"TrackerCtrl",resolve:{}});angular.module("aukeGTS").controller("TrackerCtrl",["$scope","trackerService",function($scope,trackerService){$scope.formModel=typeof $scope.formModel==="object"?$scope.formModel:{id:"",name:"",simPhone:""};$scope.update=function(mode){$scope.error="";$scope.proccessing=true;if($scope.formModel.id==""){$scope.success=false;$scope.error="This field is required";$scope.proccessing=false;return}if(mode==="register"){trackerService.create($scope.formModel.id).success(function(response){$scope.success=response.success;if(response.success){$scope.msg="Your tracker has been created successfully."}else{$scope.error="Please check make sure your services is running."}$scope.proccessing=false})}else if(mode==="delete"){trackerService.delete($scope.formModel.id).success(function(response){$scope.success=response.success;if(response.success){$scope.msg="Your tracker has delete successfully"}else{$scope.error="Tracker not exists, please try again!"}$scope.proccessing=false})}else if(mode=="load"){trackerService.load($scope.formModel.id).success(function(response){$scope.success=false;if(response.success){$scope.isDisabled=true;$scope.isUpdate=true;var data=response.data;$scope.mode="update";$scope.formModel=data[0]}else{$scope.error="Tracker not exists, please try again!"}$scope.proccessing=false})}else if(mode=="update"){trackerService.update($scope.formModel).success(function(response){$scope.success=response.success;if(response.success){$scope.msg="Your tracker has update successfully"}else{$scope.error="Tracker not exists, please try again!"}$scope.proccessing=false})}};$scope.initDefaultValue=function(){$scope.msg="";$scope.isDisabled=false;$scope.isUpdate=false;$scope.success=false;$scope.proccessing=false;$scope.error=""};$scope.initDefaultValue()}]);